<!-- Purpose: Display a year's worth of months in a calendar -->

{{ $months := seq 12 }}
{{ $context := .context }}
{{ $year := .year }}
{{ $from := .from }}
{{ $fromMonth := .fromMonth }}
{{ $to := .to }}
{{ $toMonth := .toMonth }}

{{ $yearStr := printf "%04d" $year }}


<!-- NOTE:STUPID code to force a cast, avoiding create an integer from the string
  the obvious:
  $yearInt := cast.ToInt $yearStr }}
  fails with:
  unable to cast []int{2016} of type []int to int
  and
  unable to cast "[2016]" of type string to int64
-->
{{ $temp := replace $yearStr "[" "" }}
{{ $temp2 := replace $temp "]" "" }}
{{ $yearInt := cast.ToInt $temp2 }}
<!-- temp =  $temp }}; temp2 =  $temp2 }}; yearInt = $yearInt }} -->

{{ $isLeapYear := false }}
{{ if eq (mod $yearInt 4) 0 }}
  {{ if or (ne (mod $yearInt 100) 0) (eq (mod $yearInt 400) 0) }}
    {{ $isLeapYear = true }}
    <!-- 2012, 2016, 2020 are leap years -->
  {{ end }}
{{ end }}


<div class="mx-0 calendar-year">
  {{ $articlesThisYear := index ($context.Scratch.Get "ArticlesPerYear") ( $yearStr ) }}

  {{ if gt $articlesThisYear 0 }}
    <button aria-label="toggle year" class="flex px-2 rounded-md close-folder hover:bg-sky-200 year-has-articles">
      <a href="/archive/{{ $year }}/"><h5 class="hover:bg-sky-400">{{ $yearStr }}</h5></a>
      <span class="pt-1 calendar-year-totals">&nbsp;&nbsp;({{ $articlesThisYear }})</span>
    </button>
    <!--
justify-start
divide-y divide-slate-400  user grow-1
    -->
    <div class="content-start hidden flex-initialflow-root">
      <span class="flex flex-row flex-wrap px-5">
        {{ range $months }}
          {{ if or (and (ne $year $from) (ne $year $to)) (and (eq $year $from) (ge . $fromMonth)) (and (eq $year $to) (le . $toMonth)) }}
            {{ partialCached "calendar/month" (dict "context" $context "year" $year "isLeapYear" $isLeapYear "month" .) (string  (delimit (slice $year .) "")) }}
          {{ end }}
        {{ end }}

      </span>
    </div>
    <!-----------------------------------------


    -->
  {{ else }}
    <!-- flex flex-wrap transition duration-300 ease-in-out
text-base

flex flex-wrap text-base
    -->
    <button aria-label="toggle year" calendar-year class="rounded-md close-folder hover:bg-sky-200 year-no-articles">
      <a href="/archive/{{ $year }}/"><h5 class="hover:bg-blue-400">{{ $yearStr }}</h5></a>
      <span class="pt-1 calendar-year-totals">&nbsp; ({{ $articlesThisYear }})&nbsp;</span>
    </button>

    <span class="hidden close-folder">
      {{ range $months }}
        {{ if or (and (ne $year $from) (ne $year $to)) (and (eq $year $from) (ge . $fromMonth)) (and (eq $year $to) (le . $toMonth)) }}
          {{ partialCached "calendar/month" (dict "context" $context "year" $year "isLeapYear" $isLeapYear "month" .) (string  (delimit (slice $year .) "")) }}
        {{ end }}
      {{ end }}
    </div>
    <!--hr class="hidden year-no-articles" /-->
  {{ end }}

</div>
